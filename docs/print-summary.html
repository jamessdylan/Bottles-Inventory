<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Inventory</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 40px;
    color: #111;
  }
  header {
    text-align: center;
    margin-bottom: 32px;
  }
  header img {
    max-height: 80px;
    margin-bottom: 12px;
  }
  h1 {
    font-size: 26px;
    margin: 0;
  }
  h2 {
    margin-top: 40px;
    border: 2px solid #ccc;
    padding: 10px 14px;
    text-transform: uppercase;
    border-radius: 10px;
    background: #fafafa;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
    border: 1.5px solid #ccc;
    border-radius: 10px;
    overflow: hidden;
  }
  th, td {
    padding: 8px 6px;
    font-size: 14px;
  }
  th {
    text-align: left;
    border-bottom: 1px solid #ccc;
  }
  td.right {
    text-align: right;
  }
  tr.White {
    background: rgba(201, 176, 55, 0.18);
  }
  tr.Rose\/Sparkling {
    background: rgba(217, 124, 138, 0.20);
  }
  tr.Red {
    background: rgba(123, 30, 30, 0.18);
    color: #111;
  }
  .group-total {
    font-weight: bold;
    text-align: right;
    margin-top: 8px;
  }
  .grand-total {
    margin-top: 48px;
    font-size: 28px;
    font-weight: 800;
    text-align: right;
  }
  footer {
    margin-top: 60px;
    font-size: 12px;
    color: #666;
    text-align: center;
  }
  @media print {
    body { margin: 20px; }
  }
</style>
</head>
<body>

<header>
  <img src="sienna-mercato-logo.png" alt="Sienna Mercato" />
  <h1 id="pageTitle"></h1>
</header>

<section id="house"></section>
<section id="reserve"></section>

<div class="grand-total" id="grandTotal"></div>

<footer id="timestamp"></footer>

<script>
/*
  EXPECTED INPUT (window.printItems):
  [
    {
      title: "Smart Title",
      color: "red|white|rose|gray|green",
      tier: "House|Reserve",
      quantity: 12,
      price: 18,
      total: 216
    }
  ]
*/

const items = window.printItems || [];
const pageTitle = window.sourcePageTitle || "Inventory";

document.getElementById("pageTitle").textContent = pageTitle;

function renderGroup(tier) {
  const container = document.getElementById(tier.toLowerCase());
  const groupItems = items
    .filter(i => (i.tier || "").toLowerCase() === tier.toLowerCase())
    .sort((a, b) => a.title.localeCompare(b.title));

  if (!groupItems.length) return 0;

  let sum = 0;

  const table = document.createElement("table");
  table.innerHTML = `
    <thead>
      <tr>
        <th>Item</th>
        <th class="right">Qty</th>
        <th class="right">Price</th>
        <th class="right">Total</th>
      </tr>
    </thead>
  `;

  const tbody = document.createElement("tbody");

  groupItems.forEach(item => {
    sum += item.total || 0;
    const tr = document.createElement("tr");
    tr.className = item.color || "";
    tr.innerHTML = `
      <td>${item.title}</td>
      <td class="right">${item.quantity}</td>
      <td class="right">$${Number(item.price).toFixed(2)}</td>
      <td class="right"><strong>$${Number(item.total).toFixed(2)}</strong></td>
    `;
    tbody.appendChild(tr);
  });

  table.appendChild(tbody);

  const h2 = document.createElement("h2");
  h2.textContent = tier;

  const totalDiv = document.createElement("div");
  totalDiv.className = "group-total";
  totalDiv.textContent = `${tier} Total: $${sum.toFixed(2)}`;

  container.appendChild(h2);
  container.appendChild(table);
  container.appendChild(totalDiv);

  return sum;
}

const houseTotal = renderGroup("House");
const reserveTotal = renderGroup("Reserve");

const grand = houseTotal + reserveTotal;
document.getElementById("grandTotal").textContent = `Grand Total: $${grand.toFixed(2)}`;

document.getElementById("timestamp").textContent =
  `Generated ${new Date().toLocaleString()}`;
</script>

</body>
</html>
