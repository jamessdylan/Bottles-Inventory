<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Reserve List</title>

<style>
body{
  margin:0;
  padding:24px 16px;
  background:#fff;
  color:#111;
  font-family: "Georgia", serif;
}

.page{
  max-width:760px;
  margin:0 auto;
  border:1px solid rgba(0,0,0,.15);
  padding:28px 22px 34px;
}

.brand{
  text-align:center;
  font-size:34px;
  letter-spacing:2px;
  font-weight:700;
}

.subbrand{
  text-align:center;
  font-size:14px;
  opacity:.75;
  margin-bottom:18px;
}

.section-title{
  text-align:center;
  font-size:22px;
  text-transform:uppercase;
  letter-spacing:1px;
  margin:20px 0 10px;
}

.rule{
  height:1px;
  background:rgba(0,0,0,.2);
  width:70%;
  margin:0 auto 16px;
}

.wine-row{
  text-align:center;
  margin:14px 0;
}

.wine-title{
  font-weight:700;
  letter-spacing:.6px;
  text-transform:uppercase;
  font-size:15px;
}

.wine-sub{
  font-size:13px;
  opacity:.85;
  margin-top:4px;
}

.divider{
  text-align:center;
  font-size:18px;
  letter-spacing:1px;
  margin:24px 0 8px;
}

.empty{
  text-align:center;
  font-style:italic;
  opacity:.55;
}

.footer{
  margin-top:22px;
  text-align:center;
  font-size:11px;
  opacity:.6;
}
</style>
</head>

<body>
<div class="page">
  <div class="brand" id="brand">SIENNA MERCATO</div>
  <div class="subbrand" id="subtitle"></div>

  <div class="section-title">FEATURED IMPORT</div>
  <div class="rule"></div>
  <div id="featuredImport"></div>

  <div class="section-title">VARIETAL SHOWCASE</div>
  <div class="rule"></div>
  <div id="varietalShowcase"></div>

  <div class="section-title">RESERVE</div>
  <div class="rule"></div>

  <div class="divider">SPARKLING</div>
  <div id="reserveSparkling"></div>

  <div class="divider">WHITE</div>
  <div id="reserveWhite"></div>

  <div class="divider">RED</div>
  <div id="reserveRed"></div>

  <div class="footer" id="footer"></div>
</div>

<script>
/* ---------- HELPERS ---------- */
const normalizeColor = v => {
  const c = (v || "").toLowerCase();
  if (c === "sparkling") return "Sparkling";
  if (c === "red") return "Red";
  return "White"; // includes White + Rose
};

const hasFeatured = (item, label) =>
  (item.featured || "")
    .split(",")
    .map(v => v.trim())
    .includes(label);

const titleFor = item =>
  [item.brand, item.identifier, item.varietal, item.year]
    .filter(v => v && v !== "N/A")
    .join(" ");

const priceFor = item => {
  const p = Number(item.price) || 0;
  return p > 0 ? `$${p.toFixed(2)}` : "";
};

const renderList = (el, arr) => {
  el.innerHTML = arr.length
    ? arr.map(i => `
        <div class="wine-row">
          <div class="wine-title">${titleFor(i)}</div>
          <div class="wine-sub">${priceFor(i)}</div>
        </div>
      `).join("")
    : `<div class="empty">No items</div>`;
};

/* ---------- RECEIVE DATA ---------- */
window.addEventListener("message", e => {
  const { title, items } = e.data || {};
  if (!Array.isArray(items)) return;

  document.title = title || "Reserve List";
  document.getElementById("subtitle").textContent = title || "";
  document.getElementById("footer").textContent =
    `Generated from ${title || "Inventory"}`;

  const active = items.filter(i => i.status === true);

  // Featured Import
  renderList(
    document.getElementById("featuredImport"),
    active.filter(i => hasFeatured(i, "Featured Import"))
  );

  // Varietal Showcase
  renderList(
    document.getElementById("varietalShowcase"),
    active.filter(i => hasFeatured(i, "Varietal Showcase"))
  );

  // Reserve split
  const reserve = active.filter(i => i.tier === "Reserve");

  renderList(
    document.getElementById("reserveSparkling"),
    reserve.filter(i => normalizeColor(i.color) === "Sparkling")
  );

  renderList(
    document.getElementById("reserveWhite"),
    reserve.filter(i => normalizeColor(i.color) === "White")
  );

  renderList(
    document.getElementById("reserveRed"),
    reserve.filter(i => normalizeColor(i.color) === "Red")
  );
});
</script>
</body>
</html>
